<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable='no',minimum-scale=1.0,maximum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="./css/su-carousel.css">
</head>

<body>
    <div id="wrap">
        <div class="head">
            <div class="logo-wrap">
                <a class="logo" href="http://www.baidu.com">
                    <!-- <img src="./images/logo.png" alt="logo"> -->
                </a>
            </div>
            <div class="login-wrap fr">
                <a href="javascript:;">登录</a>
            </div>
            <div class="search-wrap fr">
                <a href=""></a>
            </div>
        </div>
        <!-- 导航 -->
        <div class="su-nav-bar">
            <ul class="nav-bar-list">
                <li class="active">
                    <a href="javascript:;">首页</a>
                </li>
                <li>
                    <a href="javascript:;">MV</a>
                </li>
                <li>
                    <a href="javascript:;">悦单</a>
                </li>
                <li>
                    <a href="javascript:;">V榜</a>
                </li>
                <li>
                    <a href="javascript:;">音乐</a>
                </li>
                <li>
                    <a href="javascript:;">商城</a>
                </li>
                <li>
                    <a href="javascript:;">饭团</a>
                </li>
                <li>
                    <a href="javascript:;">咨询</a>
                </li>
                <li>
                    <a href="javascript:;">我的家</a>
                </li>
                <li>
                    <a href="javascript:;">APP下载</a>
                </li>
                <li>
                    <a href="javascript:;">热门应用</a>
                </li>
                <li>
                    <a href="javascript:;">晓飞张</a>
                </li>
                <li>
                    <a href="javascript:;">金龙油</a>
                </li>
                <li>
                    <a href="javascript:;">邱海峰</a>
                </li>
                <li>
                    <a href="javascript:;">小贱贱</a>
                </li>
                <li>
                    <a href="javascript:;">你</a>
                </li>
            </ul>
        </div>
        <!-- 主体内容区 -->
        <div class="content">
            <!-- 轮播 -->
            <div class="carousel-wrap">
                <div class="points-wrap">
                </div>
            </div>
            <!-- MV首播 -->
            <div class="mvbox firstshow">
                <div class="mvbox-title">
                    <h3 class="title fl">MV首播</h3>
                    <div class="change fr">
                        <i class="icon"></i>
                        <span>换一换</span>
                    </div>
                </div>
                <div class="mvbox-content clearfix">
                    <ul class="mvbox-loading"></ul>
                    <ul class="">
                        <li class="mvbox-item">
                            <a href="javascript:;">
                                <img src="./images/a.png" alt="">
                                <p>君に贈る花がないがないがないがないがないがないがない</p>
                            </a>
                            <div class="mvItem-discuss">
                                <div class="right">
                                    <i class="icon"></i>
                                    <span class="playNum">9176</span>
                                </div>
                                <div class="left">
                                    <i class="icon"></i>
                                    <span class="disNum">12</span>
                                </div>
                            </div>
                        </li>
                        <li class="mvbox-item">
                            <a href="javascript:;">
                                <img src="./images/b.png" alt="">
                                <p>君に贈る花がないがないがないがないがないがないがない</p>
                            </a>
                            <div class="mvItem-discuss">
                                <div class="right">
                                    <i class="icon"></i>
                                    <span class="playNum">9176</span>
                                </div>
                                <div class="left">
                                    <i class="icon"></i>
                                    <span class="disNum">12</span>
                                </div>
                            </div>
                        </li>
                        <li class="mvbox-item">
                            <a href="javascript:;">
                                <img src="./images/c.png" alt="">
                                <p>君に贈る花がないがないがないがないがないがないがない</p>
                            </a>
                            <div class="mvItem-discuss">
                                <div class="right">
                                    <i class="icon"></i>
                                    <span class="playNum">9176</span>
                                </div>
                                <div class="left">
                                    <i class="icon"></i>
                                    <span class="disNum">12</span>
                                </div>
                            </div>
                        </li>
                        <li class="mvbox-item">
                            <a href="javascript:;">
                                <img src="./images/d.jpg" alt="">
                                <p>君に贈る花がないがないがないがないがないがないがない</p>
                            </a>
                            <div class="mvItem-discuss">
                                <div class="right">
                                    <i class="icon"></i>
                                    <span class="playNum">9176</span>
                                </div>
                                <div class="left">
                                    <i class="icon"></i>
                                    <span class="disNum">12</span>
                                </div>
                            </div>
                        </li>
                        <li class="mvbox-item">
                            <a href="javascript:;">
                                <img src="./images/e.jpg" alt="">
                                <p>君に贈る花がないがないがないがないがないがないがない</p>
                            </a>
                            <div class="mvItem-discuss">
                                <div class="right">
                                    <i class="icon"></i>
                                    <span class="playNum">9176</span>
                                </div>
                                <div class="left">
                                    <i class="icon"></i>
                                    <span class="disNum">12</span>
                                </div>
                            </div>
                        </li>
                        <li class="mvbox-item">
                            <a href="javascript:;">
                                <img src="./images/f.jpg" alt="">
                                <p>君に贈る花がないがないがないがないがないがないがない</p>
                            </a>
                            <div class="mvItem-discuss">
                                <div class="right">
                                    <i class="icon"></i>
                                    <span class="playNum">9176</span>
                                </div>
                                <div class="left">
                                    <i class="icon"></i>
                                    <span class="disNum">12</span>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <ul class="mvbox-loading"></ul>
                </div>
            </div>
            <!-- MV首播 -->
            <div class="mvbox firstshow">
                <div class="mvbox-title">
                    <h3 class="title fl">MV首播</h3>
                    <div class="change fr">
                        <i class="icon"></i>
                        <span>换一换</span>
                    </div>
                </div>
                <div class="mvbox-content">
                    <ul class="mvbox-loading"></ul>
                    <ul class="clearfix">
                        <li class="mvbox-item">
                            <a href="javascript:;">
                                <img src="./images/a.png" alt="">
                                <p>君に贈る花がないがないがないがないがないがないがない</p>
                            </a>
                            <div class="mvItem-discuss">
                                <div class="right">
                                    <i class="icon"></i>
                                    <span class="playNum">9176</span>
                                </div>
                                <div class="left">
                                    <i class="icon"></i>
                                    <span class="disNum">12</span>
                                </div>
                            </div>
                        </li>
                        <li class="mvbox-item">
                            <a href="javascript:;">
                                <img src="./images/b.png" alt="">
                                <p>君に贈る花がないがないがないがないがないがないがない</p>
                            </a>
                            <div class="mvItem-discuss">
                                <div class="right">
                                    <i class="icon"></i>
                                    <span class="playNum">9176</span>
                                </div>
                                <div class="left">
                                    <i class="icon"></i>
                                    <span class="disNum">12</span>
                                </div>
                            </div>
                        </li>
                        <li class="mvbox-item">
                            <a href="javascript:;">
                                <img src="./images/c.png" alt="">
                                <p>君に贈る花がないがないがないがないがないがないがない</p>
                            </a>
                            <div class="mvItem-discuss">
                                <div class="right">
                                    <i class="icon"></i>
                                    <span class="playNum">9176</span>
                                </div>
                                <div class="left">
                                    <i class="icon"></i>
                                    <span class="disNum">12</span>
                                </div>
                            </div>
                        </li>
                        <li class="mvbox-item">
                            <a href="javascript:;">
                                <img src="./images/d.jpg" alt="">
                                <p>君に贈る花がないがないがないがないがないがないがない</p>
                            </a>
                            <div class="mvItem-discuss">
                                <div class="right">
                                    <i class="icon"></i>
                                    <span class="playNum">9176</span>
                                </div>
                                <div class="left">
                                    <i class="icon"></i>
                                    <span class="disNum">12</span>
                                </div>
                            </div>
                        </li>
                        <li class="mvbox-item">
                            <a href="javascript:;">
                                <img src="./images/e.jpg" alt="">
                                <p>君に贈る花がないがないがないがないがないがないがない</p>
                            </a>
                            <div class="mvItem-discuss">
                                <div class="right">
                                    <i class="icon"></i>
                                    <span class="playNum">9176</span>
                                </div>
                                <div class="left">
                                    <i class="icon"></i>
                                    <span class="disNum">12</span>
                                </div>
                            </div>
                        </li>
                        <li class="mvbox-item">
                            <a href="javascript:;">
                                <img src="./images/g.gif" alt="">
                                <p>君に贈る花がないがないがないがないがないがないがない</p>
                            </a>
                            <div class="mvItem-discuss">
                                <div class="right">
                                    <i class="icon"></i>
                                    <span class="playNum">9176</span>
                                </div>
                                <div class="left">
                                    <i class="icon"></i>
                                    <span class="disNum">12</span>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <ul class="mvbox-loading"></ul>
                </div>
            </div>
        </div>
    </div>


    <script src="./js/su-carousel.js"></script>
    <script src="./js/index.js"></script>
    <script>
        window.onload = function () {
            // 阻止默认事件
            document.addEventListener('touchstart', function (ev) {
                ev = ev || event
                ev.preventDefault()
            }, { passive: false })
            // rem适配
            let styleNode = document.createElement('style')
            let w = document.documentElement.clientWidth / 16
            styleNode.innerHTML = `html{font-size:${w}px !important}`
            document.head.appendChild(styleNode)

            // 使内容区能够纵向滑动
            let contentWrap = document.querySelector('.content')
            contentWrap.addEventListener('touchstart', function (ev) {
                ev.stopPropagation()
                // ev.preventDefault()
            })
            //导航
            SU.dragNav()
            // 导航的点击
            dragNavClick()
            function dragNavClick() {
                let dragNav = document.querySelector('.su-nav-bar')
                let liNodes = dragNav.querySelectorAll('li')
                let isMove = false
                dragNav.addEventListener('touchstart', function () {
                    isMove = false
                })
                dragNav.addEventListener('touchmove', function () {
                    isMove = true
                })
                dragNav.addEventListener('touchend', function (ev) {
                    if (isMove) {
                        return
                    }
                    ev = ev || event
                    let target = ev.target
                    for (let i = 0; i < liNodes.length; i++) {
                        liNodes[i].classList.remove('active')
                    }
                    if (target.nodeName.toUpperCase() === 'A') {
                        target.parentNode.classList.add('active')
                    } else if (target.nodeName.toUpperCase() === 'LI') {
                        target.classList.add('active')
                    }
                })
            }

            // tab选项卡的切换
            tabToggle()
            function tabToggle(){
                let tabWrap = document.querySelector('#wrap .content .mvbox')
                let tabContentList = document.querySelectorAll('#wrap .content .mvbox .mvbox-content')
                let w = tabWrap.offsetWidth
                console.log(w)
                for(let i=0;i<tabContentList.length;i++){
                    move(tabContentList[i])
                }

                function move(tab){
                    SU.css(tab,'translateX',-w)
                    let startPoint = {x:0,y:0}
                    let elementPoint = {x:0,y:0}
                    let nowPoint = {}   //move过程中的实时点坐标
                    let dis = {}        //move过程中的与起始坐标实时距离
                    isX = true
                    isFirst = true
                    isOver = false
                    let loadingTabs = tab.querySelectorAll('.mvbox-loading')
                    tab.addEventListener('touchstart',function(ev){
                        if(isOver){
                            return
                        }
                        ev = ev || event
                        tab.style.transition = 'none'
                        let touchC = ev.changedTouches[0]
                        startPoint.x = touchC.clientX
                        startPoint.y = touchC.clientY
                        elementPoint.x = SU.css(tab,'translateX')
                        elementPoint.y = SU.css(tab,'translateY')

                        isX = true
                        isFirst = true
                    })
                    tab.addEventListener('touchmove',function(ev){
                        if(isOver){
                            return
                        }
                        if(!isX){
                            return
                        }
                        ev = ev || event
                        let touchC = ev.changedTouches[0]
                        nowPoint.x = touchC.clientX
                        nowPoint.y = touchC.clientY  
                        dis.x = nowPoint.x - startPoint.x
                        dis.y = nowPoint.y - startPoint.y
                       
                        if(isFirst){
                            isFirst = false
                            if(Math.abs(dis.x) < Math.abs(dis.y)){
                                isX = false
                                return
                            }
                        }
                        let translateX = dis.x+elementPoint.x
                        SU.css(tab,'translateX',translateX)
                        if(Math.abs(dis.x)>w/2){
                            jump(dis.x)
                        }
                       

                    })
                    tab.addEventListener('touchend',function(ev){
                        if(isOver){
                            return
                        }
                        ev = ev || event
                        let touchC = ev.changedTouches[0]
                        leavePoint = {}
                        leavePoint.x = touchC.clientX
                        disX = leavePoint.x - startPoint.x
                        if(Math.abs(disX)<w/2){
                            tab.style.transition = '1s transform'
                            SU.css(tab,'translateX',-w)
                        }
                       

                    })

                    function jump(disX){
                        if(isOver){
                            return
                        }
                        console.log('jump')
                        if(Math.abs(disX)>w/2){
                            tab.style.transition = '1s transform'
                            let translateX = disX>0?0:(-2*w)
                            SU.css(tab,'translateX',translateX)
                            isOver = true
                            tab.addEventListener('transitionend',endFn)
                            tab.addEventListener('webkitTransitionEnd',endFn)

                            function endFn(){
                                tab.removeEventListener('transitionend',endFn)
                                tab.removeEventListener('webkitTransitionEnd',endFn)
                                tab.style.transition = 'none'
                                for(let i=0;i<loadingTabs.length;i++){
                                    loadingTabs[i].style.opacity = 1
                                }
                                setTimeout(function(){
                                    SU.css(tab,'translateX',-w)
                                    isOver = false
                                },2000)
                            }

                        }
                    }
                }
            }
            // 轮播
            let arr = ['./images/01.jpg', './images/02.jpg', './images/03.jpg', './images/04.jpg', './images/05.jpg', './images/06.jpg', './images/07.jpg', './images/08.jpg', './images/09.jpg', './images/10.jpg',]
            let setting = {
                data: arr,
                loop: true,
                autoPlay: true
            }
            SU.carousel(setting)
        }
    </script>
</body>

</html>